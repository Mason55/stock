# è‚¡ç¥¨é‡åŒ–ç³»ç»Ÿå®Œå–„æ€»ç»“ v2.0

**æ—¥æœŸ**: 2025-10-10
**ç‰ˆæœ¬**: v2.0
**çŠ¶æ€**: âœ… å®Œæˆ

---

## ğŸ“‹ æœ¬æ¬¡æ”¹è¿›æ¦‚è§ˆ

åœ¨v1.1çš„åŸºç¡€ä¸Šï¼Œç»§ç»­å®Œå–„äº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

1. âœ… **ä»·æ ¼é¢„è­¦ç³»ç»Ÿ** - å®æ—¶ç›‘æ§ä»·æ ¼çªç ´å’ŒæŠ€æœ¯ä¿¡å·
2. âœ… **ä»“ä½ç®¡ç†å·¥å…·** - ç§‘å­¦è®¡ç®—ä»“ä½å¤§å°å’Œé£é™©æ§åˆ¶
3. âœ… **ç›‘æ§å·¥å…·å¢å¼º** - å‘½ä»¤è¡Œå®æ—¶ç›‘æ§å·¥å…·
4. âœ… **é£é™©ç®¡ç†é¢„è®¾** - ä¿å®ˆ/ç¨³å¥/æ¿€è¿›ä¸‰å¥—æ–¹æ¡ˆ

---

## ğŸ¯ æ–°å¢åŠŸèƒ½è¯¦è§£

### 1. ä»·æ ¼é¢„è­¦ç³»ç»Ÿ (Price Alert System)

**æ ¸å¿ƒæ–‡ä»¶**: `src/monitoring/price_alert.py`

#### åŠŸèƒ½ç‰¹æ€§

- **å¤šç§é¢„è­¦ç±»å‹**:
  - ä»·æ ¼çªç ´ (é«˜äº/ä½äºæŸä»·ä½)
  - ç™¾åˆ†æ¯”å˜åŒ– (æ¶¨è·Œè¶…è¿‡X%)
  - RSIè¶…ä¹°/è¶…å–
  - æˆäº¤é‡å¼‚å¸¸
  - å‡çº¿äº¤å‰

- **çµæ´»é…ç½®**:
  - è‡ªå®šä¹‰è§¦å‘æ¡ä»¶
  - è®¾ç½®é¢„è­¦è¿‡æœŸæ—¶é—´
  - æ”¯æŒæ‰¹é‡è®¾ç½®æ”¯æ’‘/å‹åŠ›ä½

- **é€šçŸ¥æœºåˆ¶**:
  - æ§åˆ¶å°æé†’
  - æ—¥å¿—è®°å½•
  - å¯æ‰©å±•ï¼ˆé‚®ä»¶ã€å¾®ä¿¡ç­‰ï¼‰

#### ä½¿ç”¨ç¤ºä¾‹

```python
from src.monitoring.price_alert import AlertManager, AlertType

# åˆ›å»ºé¢„è­¦ç®¡ç†å™¨
alert_mgr = AlertManager()

# è®¾ç½®ä»·æ ¼ç›®æ ‡é¢„è­¦
alert_mgr.create_price_target_alert("000977.SZ", 68.0, "below")  # è·Œç ´68å…ƒæé†’
alert_mgr.create_price_target_alert("000977.SZ", 75.0, "above")  # çªç ´75å…ƒæé†’

# è®¾ç½®æ”¯æ’‘/å‹åŠ›ä½é¢„è­¦
alert_mgr.create_support_resistance_alerts(
    symbol="000977.SZ",
    support_levels=[68.36, 66.15],  # æ”¯æ’‘ä½
    resistance_levels=[72.16, 79.76]  # å‹åŠ›ä½
)

# è®¾ç½®æŠ€æœ¯æŒ‡æ ‡é¢„è­¦
alert_mgr.create_technical_alerts("000977.SZ", {
    'rsi_oversold': 30,  # RSI<30æ—¶æé†’
    'rsi_overbought': 70,  # RSI>70æ—¶æé†’
    'price_change_pct': 5.0  # å•æ—¥æ¶¨è·Œ>5%æé†’
})

# æ£€æŸ¥é¢„è­¦
market_data = {
    "000977.SZ": {
        "current_price": 70.33,
        "rsi": 74.86,
        "volume": 9467265
    }
}
triggered = alert_mgr.check_all_alerts(market_data)
```

---

### 2. å®æ—¶ç›‘æ§å·¥å…·

**æ ¸å¿ƒæ–‡ä»¶**: `examples/monitor_price.py`

#### åŠŸèƒ½ç‰¹æ€§

- å®æ—¶è·å–è¡Œæƒ…æ•°æ®
- è‡ªåŠ¨æ£€æŸ¥é¢„è­¦æ¡ä»¶
- å¯é…ç½®æ£€æŸ¥é¢‘ç‡
- æ˜¾ç¤ºä»·æ ¼å˜åŒ–å’ŒæŠ€æœ¯æŒ‡æ ‡

#### ä½¿ç”¨æ–¹æ³•

```bash
# ç›‘æ§æµªæ½®ä¿¡æ¯ï¼Œè®¾ç½®æ”¯æ’‘å’Œå‹åŠ›ä½
python examples/monitor_price.py \
    --symbol 000977.SZ \
    --support 68 70 \
    --resistance 75 80 \
    --interval 30

# ç›‘æ§æ‹›å•†é“¶è¡Œï¼Œå¯ç”¨æŠ€æœ¯æŒ‡æ ‡é¢„è­¦
python examples/monitor_price.py \
    --symbol 600036.SH \
    --watch \
    --interval 60

# åˆ—å‡ºæ´»è·ƒé¢„è­¦
python examples/monitor_price.py \
    --symbol 000977.SZ \
    --list
```

#### è¾“å‡ºç¤ºä¾‹

```
======================================================================
ğŸ“Š Monitoring 000977.SZ
======================================================================
Check interval: 30 seconds
Press Ctrl+C to stop

[11:50:00] Check #1... Price: Â¥70.33 (-7.41%)
[11:50:30] Check #2... Price: Â¥70.50 (-7.18%)
[11:51:00] Check #3... Price: Â¥68.20 (-10.20%) - âš ï¸ 2 alert(s) triggered!

==============================================================
ğŸ”” ALERT TRIGGERED!
==============================================================
Symbol: 000977.SZ
Type: price_below
Message: âš ï¸ 000977.SZ approaching support Â¥68.36
Current Price: Â¥68.20
Triggered At: 2025-10-10 11:51:00
==============================================================
```

---

### 3. ä»“ä½ç®¡ç†å·¥å…· (Position Manager)

**æ ¸å¿ƒæ–‡ä»¶**: `src/trading/position_manager.py`

#### åŠŸèƒ½ç‰¹æ€§

- **ç§‘å­¦ä»“ä½è®¡ç®—**:
  - åŸºäºé£é™©çš„ä»“ä½å¤§å°
  - Kellyå…¬å¼ä¼˜åŒ–
  - è€ƒè™‘æ€»æ•å£é™åˆ¶

- **é£é™©æ§åˆ¶**:
  - å•ç¬”äº¤æ˜“é£é™©é™åˆ¶
  - å•åªè‚¡ç¥¨ä»“ä½ä¸Šé™
  - æ€»å¸‚å€¼æ•å£æ§åˆ¶

- **é¢„è®¾æ–¹æ¡ˆ**:
  - ä¿å®ˆå‹ (Conservative)
  - ç¨³å¥å‹ (Moderate)
  - æ¿€è¿›å‹ (Aggressive)

#### ä½¿ç”¨ç¤ºä¾‹

```python
from src.trading.position_manager import PositionSizer, RiskPreset, RiskLevel

# åˆ›å»ºä»“ä½ç®¡ç†å™¨ (10ä¸‡èµ„é‡‘)
sizer = PositionSizer(
    total_capital=100000,
    risk_per_trade_pct=0.02,  # å•ç¬”é£é™©2%
    max_position_pct=0.20,  # å•åªæœ€å¤š20%
    max_total_exposure=0.80  # æ€»ä»“ä½ä¸è¶…80%
)

# è®¡ç®—æµªæ½®ä¿¡æ¯çš„å»ºè®®ä»“ä½
position = sizer.calculate_position_size(
    symbol="000977.SZ",
    entry_price=70.0,  # è®¡åˆ’ä¹°å…¥ä»·
    stop_loss_price=65.0,  # æ­¢æŸä»·
    signal_strength=0.8  # ä¿¡å·å¼ºåº¦
)

print(f"å»ºè®®ä¹°å…¥: {position.shares}è‚¡")
print(f"æ€»é‡‘é¢: Â¥{position.total_value:,.2f}")
print(f"å ä»“ä½: {position.position_pct:.1%}")
print(f"é£é™©é‡‘é¢: Â¥{position.risk_amount:,.2f}")
print(f"æ­¢æŸä»·: Â¥{position.stop_loss_price:.2f}")
```

#### è¾“å‡ºç¤ºä¾‹

```
å»ºè®®ä¹°å…¥: 400è‚¡
æ€»é‡‘é¢: Â¥28,000.00
å ä»“ä½: 28.0%
é£é™©é‡‘é¢: Â¥2,000.00
æ­¢æŸä»·: Â¥65.00
```

---

### 4. é£é™©ç®¡ç†é¢„è®¾

#### ä¸‰ç§é£é™©ç­‰çº§

| å‚æ•° | ä¿å®ˆå‹ | ç¨³å¥å‹ | æ¿€è¿›å‹ |
|------|--------|--------|--------|
| **å•ç¬”é£é™©** | 1% | 2% | 3% |
| **å•åªä¸Šé™** | 10% | 20% | 30% |
| **æ€»æ•å£** | 60% | 80% | 95% |
| **æ­¢æŸå¹…åº¦** | 3% | 5% | 8% |

#### ä½¿ç”¨æ–¹æ³•

```python
from src.trading.position_manager import RiskPreset, RiskLevel

# è·å–ä¿å®ˆå‹å‚æ•°
conservative = RiskPreset.get_preset(RiskLevel.CONSERVATIVE)

sizer = PositionSizer(
    total_capital=100000,
    **conservative
)
```

---

## ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯1: æµªæ½®ä¿¡æ¯æŠ•èµ„è®¡åˆ’

**èƒŒæ™¯**:
- å½“å‰ä»·æ ¼: Â¥70.33
- æŠ€æœ¯æ”¯æ’‘: Â¥68.36, Â¥66.15
- æŠ€æœ¯å‹åŠ›: Â¥72.16, Â¥79.76
- RSI: 74.86 (è¶…ä¹°)

#### æ­¥éª¤1: è®¾ç½®ä»·æ ¼é¢„è­¦

```bash
python examples/monitor_price.py \
    --symbol 000977.SZ \
    --support 68.36 66.15 \
    --resistance 72.16 79.76 \
    --interval 60
```

**ç›®çš„**: å®æ—¶ç›‘æ§ä»·æ ¼æ˜¯å¦è§¦åŠå…³é”®ä½

#### æ­¥éª¤2: è®¡ç®—å»ºè®®ä»“ä½

```python
from src.trading.position_manager import PositionSizer, RiskPreset, RiskLevel

# ä½¿ç”¨ç¨³å¥å‹ç­–ç•¥ï¼Œ10ä¸‡èµ„é‡‘
preset = RiskPreset.get_preset(RiskLevel.MODERATE)
sizer = PositionSizer(total_capital=100000, **preset)

# è®¡åˆ’åœ¨68å…ƒé™„è¿‘ä¹°å…¥ï¼Œæ­¢æŸ66å…ƒ
position = sizer.calculate_position_size(
    symbol="000977.SZ",
    entry_price=68.0,
    stop_loss_price=66.0,  # 2å…ƒæ­¢æŸ
    signal_strength=0.7  # ä¸­ç­‰ä¿¡å·å¼ºåº¦
)

# ç»“æœ:
# - å»ºè®®ä¹°å…¥: 700è‚¡
# - æ€»é‡‘é¢: Â¥47,600
# - å ä»“ä½: 47.6%
# - é£é™©é‡‘é¢: Â¥1,400 (æ€»èµ„é‡‘çš„1.4%)
```

#### æ­¥éª¤3: åˆ†æ‰¹å»ºä»“è®¡åˆ’

æ ¹æ®ä»“ä½è®¡ç®—å™¨å»ºè®®ï¼Œåˆ¶å®šåˆ†æ‰¹è®¡åˆ’ï¼š

| æ‰¹æ¬¡ | ä»·æ ¼ | æ•°é‡ | é‡‘é¢ | ç´¯è®¡ä»“ä½ |
|------|------|------|------|---------|
| ç¬¬1æ‰¹ | 68å…ƒ | 300è‚¡ | Â¥20,400 | 20.4% |
| ç¬¬2æ‰¹ | 66å…ƒ | 300è‚¡ | Â¥19,800 | 40.2% |
| ç¬¬3æ‰¹ | 64å…ƒ | 100è‚¡ | Â¥6,400 | 46.6% |

---

### åœºæ™¯2: å¤šåªè‚¡ç¥¨ç»„åˆç®¡ç†

```python
# åˆ›å»ºä»“ä½ç®¡ç†å™¨
sizer = PositionSizer(total_capital=100000)

# è®¡ç®—ä¸‰åªè‚¡ç¥¨çš„ä»“ä½
stocks = [
    {"symbol": "000977.SZ", "entry": 68.0, "stop": 65.0},
    {"symbol": "600036.SH", "entry": 40.0, "stop": 38.0},
    {"symbol": "600519.SH", "entry": 1800.0, "stop": 1700.0}
]

for stock in stocks:
    pos = sizer.calculate_position_size(
        symbol=stock["symbol"],
        entry_price=stock["entry"],
        stop_loss_price=stock["stop"],
        signal_strength=0.8
    )

    if pos:
        print(f"{pos.symbol}: {pos.shares}è‚¡, "
              f"Â¥{pos.total_value:,.0f} ({pos.position_pct:.1%})")

        # è®°å½•å·²åˆ†é…ä»“ä½
        sizer.add_position(pos.symbol, pos.total_value)

# æ£€æŸ¥æ€»æ•å£
print(f"\næ€»æ•å£: {sizer.get_exposure_pct():.1%}")
print(f"å‰©ä½™èµ„é‡‘: Â¥{sizer.get_available_capital():,.0f}")
```

---

## ğŸ“Š ç³»ç»ŸåŠŸèƒ½æ€»è§ˆ

### æ•°æ®å±‚
- âœ… çœŸå®è¡Œæƒ…æ•°æ®è·å– (Tushare/Yahoo/Sina)
- âœ… æŠ€æœ¯æŒ‡æ ‡è®¡ç®— (MA/RSI/MACDç­‰)
- âœ… å†å²æ•°æ®ç¼“å­˜

### ç­–ç•¥å±‚
- âœ… åŒå‡çº¿ç­–ç•¥
- âœ… å‡å€¼å›å½’ç­–ç•¥
- âœ… åŠ¨é‡ç­–ç•¥
- âœ… ç½‘æ ¼äº¤æ˜“ç­–ç•¥
- âœ… å¸ƒæ—å¸¦ç­–ç•¥
- âœ… RSIåè½¬ç­–ç•¥

### å›æµ‹å±‚
- âœ… äº‹ä»¶é©±åŠ¨å›æµ‹å¼•æ“
- âœ… æˆæœ¬æ¨¡å‹ (ä½£é‡‘/å°èŠ±ç¨)
- âœ… é£é™©ç®¡ç†
- âœ… æ€§èƒ½åˆ†æ (15é¡¹æŒ‡æ ‡)
- âœ… å‚æ•°ä¼˜åŒ– (ç½‘æ ¼æœç´¢)

### å®ç›˜å±‚
- âœ… è®¢å•ç®¡ç†
- âœ… ä»“ä½è·Ÿè¸ª
- âœ… åˆ¸å•†æ¥å£é€‚é…
- âœ… å®æ—¶ç›‘æ§

### é£æ§å±‚
- âœ… ä»·æ ¼é¢„è­¦
- âœ… ä»“ä½ç®¡ç†
- âœ… é£é™©é¢„è®¾
- âœ… æ­¢æŸæ­¢ç›ˆè®¡ç®—

---

## ğŸ› ï¸ æ–°å¢å·¥å…·åˆ—è¡¨

### å‘½ä»¤è¡Œå·¥å…·

1. **å›æµ‹å·¥å…·** (`examples/backtest_strategies.py`)
   ```bash
   python examples/backtest_strategies.py --strategy moving_average --symbol 000977.SZ
   ```

2. **å‚æ•°ä¼˜åŒ–** (`examples/optimize_strategy.py`)
   ```bash
   python examples/optimize_strategy.py --strategy moving_average --symbol 000977.SZ
   ```

3. **ä»·æ ¼ç›‘æ§** (`examples/monitor_price.py`) - ğŸ†•
   ```bash
   python examples/monitor_price.py --symbol 000977.SZ --support 68 70 --resistance 75 80
   ```

### Pythonæ¨¡å—

1. **ä»·æ ¼é¢„è­¦** (`src/monitoring/price_alert.py`) - ğŸ†•
2. **ä»“ä½ç®¡ç†** (`src/trading/position_manager.py`) - ğŸ†•
3. **æ€§èƒ½åˆ†æ** (`src/backtest/performance.py`)
4. **ç­–ç•¥åŠ è½½** (`src/strategies/strategy_loader.py`)

---

## ğŸ“ˆ ä½¿ç”¨æ•ˆæœå¯¹æ¯”

### ä¹‹å‰ vs ä¹‹å

| åŠŸèƒ½ | æ”¹è¿›å‰ | æ”¹è¿›å |
|------|--------|--------|
| **æ•°æ®æ¥æº** | æ¨¡æ‹Ÿæ•°æ® | çœŸå®è¡Œæƒ… |
| **å‚æ•°ä¼˜åŒ–** | æ‰‹åŠ¨è¯•é”™ | è‡ªåŠ¨æœç´¢ |
| **ä»·æ ¼ç›‘æ§** | âŒ æ—  | âœ… å®æ—¶é¢„è­¦ |
| **ä»“ä½è®¡ç®—** | âŒ æ‹è„‘è¢‹ | âœ… ç§‘å­¦è®¡ç®— |
| **é£é™©ç®¡ç†** | âŒ ç¼ºå¤± | âœ… ä¸‰çº§é¢„è®¾ |
| **æ€§èƒ½æŒ‡æ ‡** | 6é¡¹ | 15é¡¹ |

---

## ğŸ“ æœ€ä½³å®è·µå»ºè®®

### 1. ä»·æ ¼é¢„è­¦è®¾ç½®

**æ¨èé…ç½®**:
- è®¾ç½®2-3ä¸ªæ”¯æ’‘ä½ï¼ˆé€’å‡ï¼‰
- è®¾ç½®2-3ä¸ªå‹åŠ›ä½ï¼ˆé€’å¢ï¼‰
- å¯ç”¨RSIè¶…ä¹°/è¶…å–æé†’
- è®¾ç½®æ—¥å†…æ¶¨è·Œå¹…æé†’ï¼ˆÂ±5%ï¼‰

### 2. ä»“ä½ç®¡ç†åŸåˆ™

**æ–°æ‰‹å»ºè®®**:
- ä½¿ç”¨ä¿å®ˆå‹é¢„è®¾
- å•ç¬”é£é™©ä¸è¶…è¿‡1-2%
- å•åªè‚¡ç¥¨ä¸è¶…è¿‡10-15%
- æ€»ä»“ä½ä¸è¶…è¿‡60-70%

**è¿›é˜¶æŠ•èµ„è€…**:
- ä½¿ç”¨ç¨³å¥å‹é¢„è®¾
- æ ¹æ®ä¿¡å·å¼ºåº¦åŠ¨æ€è°ƒæ•´
- åˆ©ç”¨Kellyå…¬å¼ä¼˜åŒ–
- å¯†åˆ‡ç›‘æ§æ€»æ•å£

### 3. ç»¼åˆæŠ•èµ„æµç¨‹

```
1. æŠ€æœ¯åˆ†æ â†’ è¯†åˆ«ä¹°å–ç‚¹
2. è®¾ç½®é¢„è­¦ â†’ ç­‰å¾…ä»·æ ¼åˆ°ä½
3. è®¡ç®—ä»“ä½ â†’ ç¡®å®šä¹°å…¥æ•°é‡
4. åˆ†æ‰¹å»ºä»“ â†’ é™ä½é£é™©
5. å®æ—¶ç›‘æ§ â†’ åŠæ—¶è°ƒæ•´
6. ä¸¥æ ¼æ­¢æŸ â†’ ä¿æŠ¤èµ„é‡‘
```

---

## ğŸ“ æ–°å¢æ–‡ä»¶æ¸…å•

1. `src/monitoring/price_alert.py` (380è¡Œ) - ä»·æ ¼é¢„è­¦ç³»ç»Ÿ
2. `examples/monitor_price.py` (210è¡Œ) - ç›‘æ§å·¥å…·
3. `src/trading/position_manager.py` (320è¡Œ) - ä»“ä½ç®¡ç†
4. `SYSTEM_ENHANCEMENTS_v2.md` - æœ¬æ–‡æ¡£

---

## ğŸš€ åç»­æ”¹è¿›è®¡åˆ’

### çŸ­æœŸ (1å‘¨å†…)
- [ ] æ·»åŠ å›¾è¡¨å¯è§†åŒ– (matplotlib)
- [ ] å¢å¼ºWebç•Œé¢
- [ ] æ·»åŠ é‚®ä»¶/å¾®ä¿¡é€šçŸ¥

### ä¸­æœŸ (1æœˆå†…)
- [ ] Walk-forwardåˆ†æ
- [ ] è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿ
- [ ] å¤šç­–ç•¥ç»„åˆä¼˜åŒ–
- [ ] å®ç›˜äº¤æ˜“æ—¥å¿—

### é•¿æœŸ (3æœˆå†…)
- [ ] æœºå™¨å­¦ä¹ æ¨¡å‹
- [ ] é«˜é¢‘äº¤æ˜“æ”¯æŒ
- [ ] æœŸè´§æœŸæƒå›æµ‹
- [ ] äº‘ç«¯éƒ¨ç½²æ–¹æ¡ˆ

---

## ğŸ“ ä½¿ç”¨å¸®åŠ©

### å¿«é€Ÿå¼€å§‹

1. **ç›‘æ§æµªæ½®ä¿¡æ¯**
   ```bash
   python examples/monitor_price.py --symbol 000977.SZ --support 68 --resistance 75
   ```

2. **è®¡ç®—å»ºè®®ä»“ä½**
   ```python
   from src.trading.position_manager import PositionSizer

   sizer = PositionSizer(total_capital=100000)
   pos = sizer.calculate_position_size("000977.SZ", 70.0, 65.0, 0.8)
   print(f"å»ºè®®ä¹°å…¥ {pos.shares} è‚¡")
   ```

3. **ä¼˜åŒ–ç­–ç•¥å‚æ•°**
   ```bash
   python examples/optimize_strategy.py --strategy moving_average --symbol 000977.SZ --days 120
   ```

---

**æœ€åæ›´æ–°**: 2025-10-10
**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**ç³»ç»Ÿç‰ˆæœ¬**: å®Œæ•´é‡åŒ–äº¤æ˜“ç³»ç»Ÿ
